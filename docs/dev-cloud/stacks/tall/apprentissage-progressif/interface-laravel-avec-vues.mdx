# √âtape 2 : Interface Laravel

## Progression Visuelle

```mermaid
---
title: Progression & Prochaines √âtapes
config:
  theme: 'neutral'
---
graph LR
    A[<b>Base √©tablie</b>] -.-> |Configuration BDD| B["Pr√™t √† l'emploi"]
    C[<b>Prochaine phase</b>] -.->|D√©veloppement|D[Contr√¥leurs & Logique] --> |Configuration| E[Routes Laravel] -.->|Cr√©ation| F[Interface Blade] -.-> G[/Version statique/]
    D <-.->|Interaction| H[<b>Mod√®le Task</b>]

    style A fill:#e3e3f3
    style C fill:#e3e3f3
    style G fill:#e3f3e3
```

_Je vais maintenant cr√©er l'interface Laravel qui interagira avec la base de donn√©es._

## Contr√¥leur Simple et Visible

```bash
# Cr√©ation du contr√¥leur qui g√®rera toute la logique m√©tier des t√¢ches
php artisan make:controller TaskController
```

:::note Emplacement Fichier
**`app/Http/Controllers/TaskController.php`**
:::

Le **TaskController** est une classe PHP qui h√©rite de la classe **Controller** de Laravel. Il sert d'_interm√©diaire essentiel_ entre le
**mod√®le Task** et les **vues**, orchestrant toute la logique m√©tier de l'application de gestion de t√¢ches.

### Contenu de `TaskController`

```php
<?php

namespace App\Http\Controllers;

use App\Models\Task;
use Illuminate\Http\Request;

class TaskController extends Controller
{
   // Les m√©thodes seront ajout√©es ici
}
```

**Points cl√©s essentiels du contr√¥leur**

-   **Architecture :** _Utilisation du namespace **`App\Http\Controllers`** pour une organisation optimale_
-   **Importations :** _Int√©gration du **mod√®le Task** et de la **classe Request** de Laravel pour la gestion des donn√©es_
-   **Structure :** _Organisation **m√©thodique** de la logique applicative pour une maintenance facilit√©e_
-   **Bonnes pratiques :** _Respect des principes **SOLID** et des **conventions Laravel** pour un code robuste et √©volutif_

:::info SOLID
Une documentation sur **S.O.L.I.D** est en pleine r√©flexion mais pr√©vu dans les **Bases Fondamentales**.<br />
_Le lien vers cette partie sera ajout√© une fois r√©dig√©_.
:::

## Tr√®s important

:::danger Information tr√®s importante
Dans les prochaines parties, j'explique chaque m√©thode que je vais utiliser.<br />
**Pour ne pas perturber mon apprentissage**, j'affiche uniquement le code correspondant √† la m√©thode en cours.<br />
Les m√©thodes comment√©es sont remplac√©es par **`// ... Du code`**.

Aussi, il faut prendre en consid√©ration que **pour comprendre chaque partie** et ne pas **switcher de fichier en fichier de peur de perdre
le fil**, j'ai volontairement affich√© toutes les m√©thodes √† la suite les unes apr√®s les autres, puis je parle des routes et enfin des
interfaces blade. **Donc avec du bon sens, si une m√©thode est utilis√©e, il faut all√© va voir la route et l'interface correspondante**.
:::

## M√©thodes utilis√©es dans `TaskController`

### Premi√®re m√©thode : `index()`

La m√©thode **`index()`** est une m√©thode tr√®s importante, elle permet **d‚Äôafficher les t√¢ches r√©cup√©rer depuis la base de donn√©es**.<br />
( _la plus r√©cente sera afficher en premier_ ).

```php
<?php

namespace App\Http\Controllers;

use App\Models\Task;
use Illuminate\Http\Request;

class TaskController extends Controller
{
    // Afficher toutes les t√¢ches
    public function index()
    {
        $tasks = Task::latest()->get(); // Plus r√©cent en premier
        return view('tasks.index', compact('tasks'));
    }
}
```

### Seconde m√©thode : `store()`

_La m√©thode store() est simple, elle permet de cr√©er une nouvelle t√¢che en fonction de ce qui est r√©cup√©r√© dans la **request**._

```php
<?php

namespace App\Http\Controllers;

use App\Models\Task;
use Illuminate\Http\Request;

class TaskController extends Controller
{
    // ... Du code

    // Cr√©er une nouvelle t√¢che
    public function store(Request $request)
    {
        // Validation simple et claire
        $validated = $request->validate([
            'title' => 'required|min:3|max:255',
            'description' => 'nullable|max:500'
        ]);

        Task::create($validated);

        return redirect()->route('tasks.index')
                         ->with('success', 'T√¢che cr√©√©e avec succ√®s !');
    }
}
```

### Troisi√®me m√©thode : `toggle()`

_La m√©thode **`toggle()`** prends en param√®tre **Task $task** ce qui permet de basculer l'√©tat de la t√¢che qui aura √©t√© cibl√©._

```php
<?php

namespace App\Http\Controllers;

use App\Models\Task;
use Illuminate\Http\Request;

class TaskController extends Controller
{
    // ... Du code

    // Basculer l'√©tat d'une t√¢che
    public function toggle(Task $task)
    {
        $task->update(['completed' => !$task->completed]);

        return redirect()->route('tasks.index')
                         ->with('success', 'T√¢che mise √† jour !');
    }
}
```

### Quatri√®me m√©thode : `destroy()`

_La m√©thode **`destroy()`** prends √©galement un param√®tre **Task $task** afin de cibler la bonne t√¢che qui sera supprimer de la liste._

```php
<?php

namespace App\Http\Controllers;

use App\Models\Task;
use Illuminate\Http\Request;

class TaskController extends Controller
{
    // ... Du code

    // Supprimer une t√¢che
    public function destroy(Task $task)
    {
        $task->delete();

        return redirect()->route('tasks.index')
                         ->with('success', 'T√¢che supprim√©e !');
    }
}
```

## Routes Simples et Intuitives

:::note Emplacement Fichier
**`routes/web.php`**
:::

### Compr√©hension des routes utilis√©es

```mermaid
---
config:
  theme: 'neutral'
---
graph LR
    A["Client Web (Navigateur)"] --> B{Routes}
    B -->|GET| C["TaskController@index"]
    B -->|POST| D["TaskController@store"]
    B -->|PATCH| E["TaskController@toggle"]
    B -->|DELETE| F["TaskController@destroy"]

    C -->|Afficher| G["Vue tasks.index"]
    D -->|Cr√©er| H["Nouvelle T√¢che"]
    E -->|Basculer| I["√âtat T√¢che"]
    F -->|Supprimer| J["T√¢che"]

    style B fill:#e3e3f3
    style G fill:#e3f3e3
    style H fill:#e3f3e3
    style I fill:#e3f3e3
    style J fill:#e3f3e3
```

### Contenu du fichier `web.php`

```php
<?php

use App\Http\Controllers\TaskController;
use Illuminate\Support\Facades\Route;

Route::get('/', [TaskController::class, 'index'])->name('tasks.index');
Route::post('/tasks', [TaskController::class, 'store'])->name('tasks.store');
Route::patch('/tasks/{task}/toggle', [TaskController::class, 'toggle'])->name('tasks.toggle');
Route::delete('/tasks/{task}', [TaskController::class, 'destroy'])->name('tasks.destroy');
```

#### Explication d√©taill√©e des routes

-   **GET /** : _Point d'entr√©e principal_ - Affiche l'interface de gestion des t√¢ches avec la liste compl√®te
-   **POST /tasks** : _Endpoint de cr√©ation_ - Traite la soumission du formulaire pour cr√©er une nouvelle t√¢che
-   **PATCH /tasks/\{task\}/toggle** : _Gestion de l'√©tat_ - Permet de basculer dynamiquement entre t√¢che compl√©t√©e et non-compl√©t√©e
-   **DELETE /tasks/\{task\}** : _Suppression s√©curis√©e_ - G√®re la suppression permanente d'une t√¢che sp√©cifique

## Interface Blade Moderne

:::note Emplacement Dossier contenant les interfaces
**`resources/views/tasks/`**
_**tasks** est un dossier cr√©√© manuellement._
:::

### Layout : `app.blade.php`

:::note Emplacement Fichier
**`resources/views/layouts/app.blade.php`**
:::

```html
<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>TALL Tasks</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script
            defer
            src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
    </head>
    <body class="bg-gray-100">
        <div class="min-h-screen">
            <!-- Header avec progression -->
            <header class="bg-white shadow-sm border-b">
                <div class="max-w-4xl mx-auto px-6 py-4">
                    <div class="flex items-center justify-between">
                        <h1 class="text-2xl font-bold text-gray-800">
                            TALL Tasks
                        </h1>
                        <div class="text-sm text-gray-600">
                            √âtape 3:
                            <span class="text-green-600 font-medium"
                                >Interface Laravel ‚úì</span
                            >
                        </div>
                    </div>
                </div>
            </header>

            <!-- Contenu principal -->
            <main class="py-8">@yield('content')</main>
        </div>
    </body>
</html>
```

### Vue principale : `index.blade.php`

:::note Emplacement Fichier
**`resources/views/tasks/index.blade.php`**
:::

```html
@extends('layouts.app') @section('content')
<div class="max-w-4xl mx-auto px-6">
    <!-- Messages de succ√®s -->
    @if(session('success'))
    <div
        class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg"
        x-data="{ show: true }"
        x-show="show"
        x-transition
    >
        {{ session('success') }}
        <button
            @click="show = false"
            class="ml-2 text-green-500 hover:text-green-700"
        >
            &times;
        </button>
    </div>
    @endif

    <!-- Formulaire d'ajout -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">‚ûï Ajouter une t√¢che</h2>

        <form action="{{ route('tasks.store') }}" method="POST">
            @csrf
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                        >Titre *</label
                    >
                    <input
                        type="text"
                        name="title"
                        value="{{ old('title') }}"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 @error('title') border-red-500 @enderror"
                        placeholder="Ex: Terminer le projet"
                    />
                    @error('title')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2"
                        >Description</label
                    >
                    <input
                        type="text"
                        name="description"
                        value="{{ old('description') }}"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                        placeholder="D√©tails optionnels..."
                    />
                    @error('description')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>

            <button
                type="submit"
                class="mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
                üíæ Enregistrer la t√¢che
            </button>
        </form>
    </div>

    <!-- Statistiques simples -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div class="bg-white p-4 rounded-lg shadow text-center">
            <div class="text-2xl font-bold text-blue-600">
                {{ $tasks->count() }}
            </div>
            <div class="text-gray-600">Total</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow text-center">
            <div class="text-2xl font-bold text-green-600">
                {{ $tasks->where('completed', true)->count() }}
            </div>
            <div class="text-gray-600">Termin√©es</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow text-center">
            <div class="text-2xl font-bold text-yellow-600">
                {{ $tasks->where('completed', false)->count() }}
            </div>
            <div class="text-gray-600">En cours</div>
        </div>
    </div>

    <!-- Liste des t√¢ches -->
    <div class="bg-white rounded-lg shadow-md">
        <div class="p-4 border-b">
            <h2 class="text-xl font-semibold">
                üìã Mes T√¢ches ({{ $tasks->count() }})
            </h2>
        </div>

        @forelse($tasks as $task)
        <div
            class="p-4 border-b last:border-b-0 hover:bg-gray-50 transition-colors"
        >
            <div class="flex items-center justify-between">
                <div class="flex-1">
                    <h3
                        class="font-medium {{ $task->completed ? 'line-through text-gray-500' : 'text-gray-800' }}"
                    >
                        {{ $task->title }}
                    </h3>
                    @if($task->description)
                    <p
                        class="text-sm text-gray-600 mt-1 {{ $task->completed ? 'line-through' : '' }}"
                    >
                        {{ $task->description }}
                    </p>
                    @endif
                    <p class="text-xs text-gray-400 mt-2">
                        Cr√©√©e {{ $task->created_at->diffForHumans() }}
                    </p>
                </div>

                <div class="flex items-center gap-2 ml-4">
                    <!-- Toggle completion -->
                    <form
                        action="{{ route('tasks.toggle', $task) }}"
                        method="POST"
                        class="inline"
                    >
                        @csrf @method('PATCH')
                        <button
                            type="submit"
                            class="p-2 rounded-lg transition-colors {{ $task->completed ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700 hover:bg-green-100' }}"
                        >
                            {{ $task->completed ? '‚úÖ' : '‚è≥' }}
                        </button>
                    </form>

                    <!-- Delete -->
                    <form
                        action="{{ route('tasks.destroy', $task) }}"
                        method="POST"
                        class="inline"
                        onsubmit="return confirm('√ätes-vous s√ªr de vouloir supprimer cette t√¢che ?')"
                    >
                        @csrf @method('DELETE')
                        <button
                            type="submit"
                            class="p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors"
                        >
                            üóëÔ∏è
                        </button>
                    </form>
                </div>
            </div>
        </div>
        @empty
        <div class="p-8 text-center text-gray-500">
            <div class="text-4xl mb-4">üìù</div>
            <p>
                Aucune t√¢che pour le moment. Cr√©ez votre premi√®re t√¢che
                ci-dessus !
            </p>
        </div>
        @endforelse
    </div>
</div>
@endsection
```

## Compr√©hension via un diagramme de s√©quence

_Pour bien comprendre ce qu'il se passe, voici un diagramme de s√©quence propos√© afin d'analyser chaque √©tape et surtout permettre de comprendre
ce qu'il se passe en arri√®re plan._

```mermaid
---
config:
  theme: 'neutral'
---
sequenceDiagram
    participant U as Utilisateur
    participant B as Navigateur
    participant R as Routes Laravel
    participant C as TaskController
    participant M as Mod√®le Task
    participant V as Vue Blade
    participant DB as Base de donn√©es

    U->>B: Visite la page
    B->>R: GET /
    R->>C: index()
    C->>M: Task::latest()->get()
    M->>DB: SELECT * FROM tasks
    DB-->>M: Donn√©es des t√¢ches
    M-->>C: Collection de t√¢ches
    C->>V: Vue avec $tasks
    V-->>B: HTML g√©n√©r√©
    B-->>U: Page affich√©e

    U->>B: Ajoute une t√¢che
    B->>R: POST /tasks
    R->>C: store()
    C->>M: Task::create()
    M->>DB: INSERT INTO tasks
    DB-->>M: T√¢che cr√©√©e
    M-->>C: Succ√®s
    C-->>B: Redirection
    B-->>U: Page mise √† jour
```

<br />

:::tip R√©sultat imm√©diat
Application Laravel compl√®te et fonctionnelle !
:::
